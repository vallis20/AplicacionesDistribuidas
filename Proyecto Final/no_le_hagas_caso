# Importa la clase BaseDatos
from connectionbd import BaseDatos

# Función para generar el ticket en HTML con datos de usuarios
def generate_user_ticket(users_data, payment_details):
    payment_method = payment_details.get('payment_method', 'No especificado')
    payment_amount = payment_details.get('payment_amount', 'No especificado')
    card_number = payment_details.get('card_number', 'No especificado')

    # Estructura básica del ticket en HTML
    ticket_html = '''
    <html>
    <head>
        <title>Ticket de Usuarios</title>
        <style>
            /* Estilos CSS para el ticket */
            /* ... Estilos personalizados ... */
        </style>
    </head>
    <body>
        <h1>Reporte de Usuarios</h1>
        <div class="ticket-content">
            <table border="1">
                <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Email</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Fecha de Registro</th>
                </tr>
    '''
    # Iterar sobre los datos de usuarios y agregar filas a la tabla en HTML
    for user in users_data:
        ticket_html += '<tr>'
        ticket_html += f'<td>{user[0]}</td>'  # ID
        ticket_html += f'<td>{user[1]}</td>'  # Usuario
        ticket_html += f'<td>{user[2]}</td>'  # Email
        ticket_html += f'<td>{user[3]}</td>'  # Nombre
        ticket_html += f'<td>{user[4]}</td>'  # Apellido
        ticket_html += f'<td>{user[5]}</td>'  # Fecha de Registro
        ticket_html += '</tr>'
    
    # Detalles del pago
    ticket_html += '''
            <tr>
                <td colspan="6">Detalles del Pago:</td>
            </tr>
            <tr>
                <td colspan="6">Método de Pago: {payment_method}</td>
            </tr>
            <tr>
                <td colspan="6">Monto de Pago: {payment_amount}</td>
            </tr>
            <tr>
                <td colspan="6">Número de Tarjeta: {card_number}</td>
            </tr>
    '''
    
    # Cerrar la estructura del ticket en HTML
    ticket_html += '''
            </table>
        </div>
    </body>
    </html>
    '''

    # Escribir el contenido en un archivo HTML
    with open('ticket_usuarios.html', 'w') as file:
        file.write(ticket_html)


# Crea una instancia de la clase BaseDatos
mi_bd = BaseDatos()

# Intenta establecer la conexión
mi_bd.connect()

# Realiza una consulta en la tabla Usuarios
user_data = mi_bd.query_table('Usuarios')

# Genera el ticket en HTML con los datos de usuarios obtenidos
payment_details = {
    'payment_method': 'Tarjeta',
    'payment_amount': '$99.99',
    'card_number': '**** **** **** 0951'
}
if user_data:
    generate_user_ticket(user_data, payment_details)
    print("Ticket de Usuarios generado: ticket_usuarios.html")
else:
    print("No hay datos de usuarios")

generate_user_ticket(user_data, payment_method="Tarjeta", payment_amount="$99.99", card_number="**** **** **** 0951")
# Cierra la conexión
mi_bd.disconnect()
